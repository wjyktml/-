<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NextsPay 后台管理系统</title>
    <link rel="icon" type="image/x-icon" href="../images/favicon.ico">
    
    <!-- CSS Files -->
    <link rel="stylesheet" href="../css/bootstrap.css">
    <link rel="stylesheet" href="../css/element.css">
    <link rel="stylesheet" href="../css/fonts.css">
    <link rel="stylesheet" href="../css/style-5.css">
    
    <style>
        .admin-container {
            min-height: 100vh;
            background: #f5f5f5;
        }
        .sidebar {
            background: #2c3e50;
            min-height: 100vh;
            color: white;
            padding: 0;
        }
        .sidebar-header {
            background: #34495e;
            padding: 20px;
            text-align: center;
        }
        .sidebar-menu {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        .sidebar-menu li {
            border-bottom: 1px solid #34495e;
        }
        .sidebar-menu a {
            display: block;
            padding: 15px 20px;
            color: #bdc3c7;
            text-decoration: none;
            transition: all 0.3s ease;
        }
        .sidebar-menu a:hover,
        .sidebar-menu a.active {
            background: #3498db;
            color: white;
        }
        .main-content {
            padding: 20px;
        }
        .content-header {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .content-body {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .stats-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        .stats-number {
            font-size: 2rem;
            font-weight: bold;
        }
        .table-actions {
            white-space: nowrap;
        }
        .image-preview {
            width: 60px;
            height: 60px;
            object-fit: cover;
            border-radius: 8px;
        }
    </style>
</head>
<body>
    <div id="app">
        <div class="admin-container">
            <div class="row no-gutters">
                <!-- 侧边栏 -->
                <div class="col-md-3 col-lg-2">
                    <div class="sidebar">
                        <div class="sidebar-header">
                            <h4>NextsPay</h4>
                            <small>后台管理系统</small>
                        </div>
                        <ul class="sidebar-menu">
                            <li>
                                <a href="#" @click="currentView = 'dashboard'" :class="{ active: currentView === 'dashboard' }">
                                    <i class="fa fa-dashboard"></i> 仪表盘
                                </a>
                            </li>
                            <li>
                                <a href="#" @click="currentView = 'products'" :class="{ active: currentView === 'products' }">
                                    <i class="fa fa-shopping-bag"></i> 商品管理
                                </a>
                            </li>
                            <li>
                                <a href="#" @click="currentView = 'categories'" :class="{ active: currentView === 'categories' }">
                                    <i class="fa fa-tags"></i> 分类管理
                                </a>
                            </li>
                            <li>
                                <a href="#" @click="currentView = 'orders'" :class="{ active: currentView === 'orders' }">
                                    <i class="fa fa-file-text"></i> 订单管理
                                </a>
                            </li>
                            <li>
                                <a href="#" @click="currentView = 'payments'" :class="{ active: currentView === 'payments' }">
                                    <i class="fa fa-credit-card"></i> 支付配置
                                </a>
                            </li>
                            <li>
                                <a href="#" @click="currentView = 'telegram'" :class="{ active: currentView === 'telegram' }">
                                    <i class="fa fa-telegram"></i> Telegram通知
                                </a>
                            </li>
                            <li>
                                <a href="#" @click="currentView = 'settings'" :class="{ active: currentView === 'settings' }">
                                    <i class="fa fa-cog"></i> 系统设置
                                </a>
                            </li>
                        </ul>
                    </div>
                </div>

                <!-- 主内容区 -->
                <div class="col-md-9 col-lg-10">
                    <div class="main-content">
                        <!-- 仪表盘 -->
                        <div v-if="currentView === 'dashboard'">
                            <div class="content-header">
                                <h3><i class="fa fa-dashboard"></i> 仪表盘</h3>
                            </div>
                            <div class="row">
                                <div class="col-md-3">
                                    <div class="stats-card">
                                        <div class="stats-number">{{ stats.totalOrders }}</div>
                                        <div>总订单数</div>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="stats-card">
                                        <div class="stats-number">¥{{ stats.totalRevenue }}</div>
                                        <div>总收入</div>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="stats-card">
                                        <div class="stats-number">{{ stats.totalProducts }}</div>
                                        <div>商品数量</div>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="stats-card">
                                        <div class="stats-number">{{ stats.totalUsers }}</div>
                                        <div>用户数量</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 商品管理 -->
                        <div v-if="currentView === 'products'">
                            <div class="content-header">
                                <h3><i class="fa fa-shopping-bag"></i> 商品管理</h3>
                                <el-button type="primary" @click="showProductDialog = true">
                                    <i class="fa fa-plus"></i> 添加商品
                                </el-button>
                            </div>
                            <div class="content-body">
                                <el-table :data="products" style="width: 100%">
                                    <el-table-column prop="id" label="ID" width="80"></el-table-column>
                                    <el-table-column label="图片" width="100">
                                        <template slot-scope="scope">
                                            <img :src="scope.row.image" class="image-preview">
                                        </template>
                                    </el-table-column>
                                    <el-table-column prop="name" label="商品名称"></el-table-column>
                                    <el-table-column prop="category_name" label="分类"></el-table-column>
                                    <el-table-column prop="price" label="价格" width="120">
                                        <template slot-scope="scope">
                                            ¥{{ scope.row.price }}
                                        </template>
                                    </el-table-column>
                                    <el-table-column prop="stock" label="库存" width="100"></el-table-column>
                                    <el-table-column prop="status" label="状态" width="100">
                                        <template slot-scope="scope">
                                            <el-tag :type="scope.row.status === 'active' ? 'success' : 'danger'">
                                                {{ scope.row.status === 'active' ? '上架' : '下架' }}
                                            </el-tag>
                                        </template>
                                    </el-table-column>
                                    <el-table-column label="操作" width="200" class="table-actions">
                                        <template slot-scope="scope">
                                            <el-button size="mini" @click="editProduct(scope.row)">编辑</el-button>
                                            <el-button size="mini" type="danger" @click="deleteProduct(scope.row)">删除</el-button>
                                        </template>
                                    </el-table-column>
                                </el-table>
                            </div>
                        </div>

                        <!-- 分类管理 -->
                        <div v-if="currentView === 'categories'">
                            <div class="content-header">
                                <h3><i class="fa fa-tags"></i> 分类管理</h3>
                                <el-button type="primary" @click="showCategoryDialog = true">
                                    <i class="fa fa-plus"></i> 添加分类
                                </el-button>
                            </div>
                            <div class="content-body">
                                <el-table :data="categories" style="width: 100%">
                                    <el-table-column prop="id" label="ID" width="80"></el-table-column>
                                    <el-table-column prop="name" label="分类名称"></el-table-column>
                                    <el-table-column prop="description" label="描述"></el-table-column>
                                    <el-table-column prop="product_count" label="商品数量" width="120"></el-table-column>
                                    <el-table-column label="操作" width="200">
                                        <template slot-scope="scope">
                                            <el-button size="mini" @click="editCategory(scope.row)">编辑</el-button>
                                            <el-button size="mini" type="danger" @click="deleteCategory(scope.row)">删除</el-button>
                                        </template>
                                    </el-table-column>
                                </el-table>
                            </div>
                        </div>

                        <!-- 订单管理 -->
                        <div v-if="currentView === 'orders'">
                            <div class="content-header">
                                <h3><i class="fa fa-file-text"></i> 订单管理</h3>
                            </div>
                            <div class="content-body">
                                <el-table :data="orders" style="width: 100%">
                                    <el-table-column prop="order_no" label="订单号"></el-table-column>
                                    <el-table-column prop="total_amount" label="金额" width="120">
                                        <template slot-scope="scope">
                                            ¥{{ scope.row.total_amount }}
                                        </template>
                                    </el-table-column>
                                    <el-table-column prop="payment_type" label="支付方式" width="120"></el-table-column>
                                    <el-table-column prop="status" label="状态" width="120">
                                        <template slot-scope="scope">
                                            <el-tag :type="getOrderStatusType(scope.row.status)">
                                                {{ getOrderStatusText(scope.row.status) }}
                                            </el-tag>
                                        </template>
                                    </el-table-column>
                                    <el-table-column prop="create_time" label="创建时间" width="180"></el-table-column>
                                    <el-table-column label="操作" width="150">
                                        <template slot-scope="scope">
                                            <el-button size="mini" @click="viewOrder(scope.row)">查看</el-button>
                                        </template>
                                    </el-table-column>
                                </el-table>
                            </div>
                        </div>

                        <!-- 支付配置 -->
                        <div v-if="currentView === 'payments'">
                            <div class="content-header">
                                <h3><i class="fa fa-credit-card"></i> 支付配置</h3>
                            </div>
                            <div class="content-body">
                                <el-tabs v-model="activePaymentTab">
                                    <el-tab-pane label="微信支付" name="wechat">
                                        <el-form :model="paymentConfig.wechat" label-width="120px">
                                            <el-form-item label="启用状态">
                                                <el-switch v-model="paymentConfig.wechat.enabled"></el-switch>
                                            </el-form-item>
                                            <el-form-item label="App ID">
                                                <el-input v-model="paymentConfig.wechat.app_id"></el-input>
                                            </el-form-item>
                                            <el-form-item label="商户号">
                                                <el-input v-model="paymentConfig.wechat.mch_id"></el-input>
                                            </el-form-item>
                                            <el-form-item label="API密钥">
                                                <el-input v-model="paymentConfig.wechat.api_key" type="password" show-password></el-input>
                                            </el-form-item>
                                            <el-form-item label="证书路径">
                                                <el-input v-model="paymentConfig.wechat.cert_path"></el-input>
                                            </el-form-item>
                                        </el-form>
                                    </el-tab-pane>
                                    
                                    <el-tab-pane label="支付宝" name="alipay">
                                        <el-form :model="paymentConfig.alipay" label-width="120px">
                                            <el-form-item label="启用状态">
                                                <el-switch v-model="paymentConfig.alipay.enabled"></el-switch>
                                            </el-form-item>
                                            <el-form-item label="应用ID">
                                                <el-input v-model="paymentConfig.alipay.app_id"></el-input>
                                            </el-form-item>
                                            <el-form-item label="商户私钥">
                                                <el-input v-model="paymentConfig.alipay.private_key" type="textarea" rows="4"></el-input>
                                            </el-form-item>
                                            <el-form-item label="支付宝公钥">
                                                <el-input v-model="paymentConfig.alipay.public_key" type="textarea" rows="4"></el-input>
                                            </el-form-item>
                                        </el-form>
                                    </el-tab-pane>
                                    
                                    <el-tab-pane label="银联支付" name="unionpay">
                                        <el-form :model="paymentConfig.unionpay" label-width="120px">
                                            <el-form-item label="启用状态">
                                                <el-switch v-model="paymentConfig.unionpay.enabled"></el-switch>
                                            </el-form-item>
                                            <el-form-item label="商户号">
                                                <el-input v-model="paymentConfig.unionpay.mer_id"></el-input>
                                            </el-form-item>
                                            <el-form-item label="证书ID">
                                                <el-input v-model="paymentConfig.unionpay.cert_id"></el-input>
                                            </el-form-item>
                                            <el-form-item label="私钥">
                                                <el-input v-model="paymentConfig.unionpay.private_key" type="textarea" rows="4"></el-input>
                                            </el-form-item>
                                        </el-form>
                                    </el-tab-pane>
                                    
                                    <el-tab-pane label="Stripe" name="stripe">
                                        <el-form :model="paymentConfig.stripe" label-width="120px">
                                            <el-form-item label="启用状态">
                                                <el-switch v-model="paymentConfig.stripe.enabled"></el-switch>
                                            </el-form-item>
                                            <el-form-item label="发布密钥">
                                                <el-input v-model="paymentConfig.stripe.publishable_key"></el-input>
                                            </el-form-item>
                                            <el-form-item label="密钥">
                                                <el-input v-model="paymentConfig.stripe.secret_key" type="password" show-password></el-input>
                                            </el-form-item>
                                            <el-form-item label="Webhook密钥">
                                                <el-input v-model="paymentConfig.stripe.webhook_secret" type="password" show-password></el-input>
                                            </el-form-item>
                                        </el-form>
                                    </el-tab-pane>
                                </el-tabs>
                                
                                <div class="text-center mt-4">
                                    <el-button type="primary" @click="savePaymentConfig" :loading="savingConfig">
                                        保存配置
                                    </el-button>
                                </div>
                            </div>
                        </div>

                        <!-- Telegram通知配置 -->
                        <div v-if="currentView === 'telegram'">
                            <div class="content-header">
                                <h3><i class="fa fa-telegram"></i> Telegram通知配置</h3>
                            </div>
                            <div class="content-body">
                                <el-tabs v-model="activeTelegramTab">
                                    <el-tab-pane label="基本配置" name="basic">
                                        <el-form :model="telegramConfig" label-width="150px">
                                            <el-form-item label="启用通知">
                                                <el-switch v-model="telegramConfig.enabled"></el-switch>
                                            </el-form-item>
                                            <el-form-item label="Bot Token">
                                                <el-input v-model="telegramConfig.bot_token" type="password" show-password placeholder="从@BotFather获取"></el-input>
                                                <small class="text-muted">从 @BotFather 获取机器人Token</small>
                                            </el-form-item>
                                            <el-form-item label="Chat ID">
                                                <el-input v-model="telegramConfig.chat_id" placeholder="群组ID或用户ID"></el-input>
                                                <small class="text-muted">接收通知的群组ID或用户ID</small>
                                            </el-form-item>
                                        </el-form>
                                        
                                        <div class="text-center mt-4">
                                            <el-button type="primary" @click="saveTelegramConfig" :loading="savingTelegram">
                                                保存配置
                                            </el-button>
                                            <el-button @click="testTelegramConnection" :loading="testingConnection">
                                                测试连接
                                            </el-button>
                                            <el-button @click="sendTestMessage" :loading="sendingTest">
                                                发送测试消息
                                            </el-button>
                                        </div>
                                    </el-tab-pane>
                                    
                                    <el-tab-pane label="Webhook设置" name="webhook">
                                        <el-form label-width="150px">
                                            <el-form-item label="Webhook URL">
                                                <el-input v-model="webhookUrl" placeholder="https://api.bohai.chat/web/telegram_webhook.php"></el-input>
                                            </el-form-item>
                                            <el-form-item label="当前状态">
                                                <el-tag :type="webhookStatus ? 'success' : 'danger'">
                                                    {{ webhookStatus ? '已设置' : '未设置' }}
                                                </el-tag>
                                            </el-form-item>
                                        </el-form>
                                        
                                        <div class="text-center mt-4">
                                            <el-button type="primary" @click="setWebhook" :loading="settingWebhook">
                                                设置Webhook
                                            </el-button>
                                            <el-button @click="getWebhookInfo" :loading="gettingWebhook">
                                                查看信息
                                            </el-button>
                                            <el-button type="danger" @click="deleteWebhook" :loading="deletingWebhook">
                                                删除Webhook
                                            </el-button>
                                        </div>
                                    </el-tab-pane>
                                    
                                    <el-tab-pane label="通知统计" name="stats">
                                        <div class="row">
                                            <div class="col-md-6">
                                                <div class="card">
                                                    <div class="card-body">
                                                        <h5>通知统计（最近7天）</h5>
                                                        <div v-for="stat in notificationStats" :key="stat.type" class="mb-2">
                                                            <div class="d-flex justify-content-between">
                                                                <span>{{ getNotificationTypeName(stat.type) }}</span>
                                                                <span>{{ stat.total }} 条</span>
                                                            </div>
                                                            <div class="progress" style="height: 5px;">
                                                                <div class="progress-bar" :style="{width: (stat.telegram_success / stat.total * 100) + '%'}"></div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="card">
                                                    <div class="card-body">
                                                        <h5>配置状态</h5>
                                                        <div v-for="(status, key) in configStatus" :key="key" class="mb-2">
                                                            <div class="d-flex justify-content-between">
                                                                <span>{{ getConfigKeyName(key) }}</span>
                                                                <el-tag :type="status ? 'success' : 'danger'">
                                                                    {{ status ? '正常' : '异常' }}
                                                                </el-tag>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <div class="text-center mt-4">
                                            <el-button @click="refreshStats">刷新统计</el-button>
                                            <el-button @click="testNotification">测试通知</el-button>
                                            <el-button @click="sendSystemStatus">发送系统状态</el-button>
                                        </div>
                                    </el-tab-pane>
                                </el-tabs>
                            </div>
                        </div>

                        <!-- 系统设置 -->
                        <div v-if="currentView === 'settings'">
                            <div class="content-header">
                                <h3><i class="fa fa-cog"></i> 系统设置</h3>
                            </div>
                            <div class="content-body">
                                <el-form :model="systemSettings" label-width="150px">
                                    <el-form-item label="网站名称">
                                        <el-input v-model="systemSettings.site_name"></el-input>
                                    </el-form-item>
                                    <el-form-item label="网站描述">
                                        <el-input v-model="systemSettings.site_description" type="textarea"></el-input>
                                    </el-form-item>
                                    <el-form-item label="联系邮箱">
                                        <el-input v-model="systemSettings.contact_email"></el-input>
                                    </el-form-item>
                                    <el-form-item label="联系电话">
                                        <el-input v-model="systemSettings.contact_phone"></el-input>
                                    </el-form-item>
                                    <el-form-item label="订单超时时间(分钟)">
                                        <el-input-number v-model="systemSettings.order_timeout" :min="5" :max="60"></el-input-number>
                                    </el-form-item>
                                    <el-form-item label="启用维护模式">
                                        <el-switch v-model="systemSettings.maintenance_mode"></el-switch>
                                    </el-form-item>
                                </el-form>
                                
                                <div class="text-center mt-4">
                                    <el-button type="primary" @click="saveSystemSettings" :loading="savingSettings">
                                        保存设置
                                    </el-button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 商品编辑弹窗 -->
        <el-dialog :title="editingProduct ? '编辑商品' : '添加商品'" :visible.sync="showProductDialog" width="600px">
            <el-form :model="productForm" label-width="100px">
                <el-form-item label="商品名称" required>
                    <el-input v-model="productForm.name"></el-input>
                </el-form-item>
                <el-form-item label="商品描述">
                    <el-input v-model="productForm.description" type="textarea" rows="3"></el-input>
                </el-form-item>
                <el-form-item label="分类" required>
                    <el-select v-model="productForm.category_id" placeholder="选择分类">
                        <el-option v-for="cat in categories" :key="cat.id" :label="cat.name" :value="cat.id"></el-option>
                    </el-select>
                </el-form-item>
                <el-form-item label="价格" required>
                    <el-input-number v-model="productForm.price" :min="0" :precision="2"></el-input-number>
                </el-form-item>
                <el-form-item label="库存" required>
                    <el-input-number v-model="productForm.stock" :min="0"></el-input-number>
                </el-form-item>
                <el-form-item label="商品图片">
                    <el-upload
                        class="upload-demo"
                        action="#"
                        :auto-upload="false"
                        :on-change="handleImageChange">
                        <el-button size="small" type="primary">选择图片</el-button>
                    </el-upload>
                </el-form-item>
                <el-form-item label="状态">
                    <el-switch v-model="productForm.status" active-value="active" inactive-value="inactive"></el-switch>
                </el-form-item>
            </el-form>
            <div slot="footer">
                <el-button @click="showProductDialog = false">取消</el-button>
                <el-button type="primary" @click="saveProduct">保存</el-button>
            </div>
        </el-dialog>

        <!-- 分类编辑弹窗 -->
        <el-dialog :title="editingCategory ? '编辑分类' : '添加分类'" :visible.sync="showCategoryDialog" width="400px">
            <el-form :model="categoryForm" label-width="100px">
                <el-form-item label="分类名称" required>
                    <el-input v-model="categoryForm.name"></el-input>
                </el-form-item>
                <el-form-item label="描述">
                    <el-input v-model="categoryForm.description" type="textarea" rows="3"></el-input>
                </el-form-item>
            </el-form>
            <div slot="footer">
                <el-button @click="showCategoryDialog = false">取消</el-button>
                <el-button type="primary" @click="saveCategory">保存</el-button>
            </div>
        </el-dialog>
    </div>

    <!-- JavaScript Files -->
    <script src="../js/jquery.js"></script>
    <script src="../js/vue.js"></script>
    <script src="../js/element.js"></script>
    <script src="../js/axios.min.js"></script>
    <script src="../js/util.js"></script>
    <script src="../js/api.js"></script>
    <script>
        new Vue({
            el: '#app',
            data() {
                return {
                    currentView: 'dashboard',
                    activePaymentTab: 'wechat',
                    
                    // 统计数据
                    stats: {
                        totalOrders: 1250,
                        totalRevenue: '156,789.00',
                        totalProducts: 45,
                        totalUsers: 890
                    },
                    
                    // 商品管理
                    products: [],
                    showProductDialog: false,
                    editingProduct: false,
                    productForm: {
                        id: null,
                        name: '',
                        description: '',
                        category_id: '',
                        price: 0,
                        stock: 0,
                        image: '',
                        status: 'active'
                    },
                    
                    // 分类管理
                    categories: [],
                    showCategoryDialog: false,
                    editingCategory: false,
                    categoryForm: {
                        id: null,
                        name: '',
                        description: ''
                    },
                    
                    // 订单管理
                    orders: [],
                    
                    // 支付配置
                    paymentConfig: {
                        wechat: {
                            enabled: true,
                            app_id: '',
                            mch_id: '',
                            api_key: '',
                            cert_path: ''
                        },
                        alipay: {
                            enabled: true,
                            app_id: '',
                            private_key: '',
                            public_key: ''
                        },
                        unionpay: {
                            enabled: true,
                            mer_id: '',
                            cert_id: '',
                            private_key: ''
                        },
                        stripe: {
                            enabled: true,
                            publishable_key: '',
                            secret_key: '',
                            webhook_secret: ''
                        }
                    },
                    savingConfig: false,
                    
                    // 系统设置
                    systemSettings: {
                        site_name: 'NextsPay',
                        site_description: '专业的支付解决方案',
                        contact_email: 'support@bohai.chat',
                        contact_phone: '400-123-4567',
                        order_timeout: 15,
                        maintenance_mode: false
                    },
                    savingSettings: false,
                    
                    // Telegram配置
                    telegramConfig: {
                        enabled: false,
                        bot_token: '',
                        chat_id: ''
                    },
                    activeTelegramTab: 'basic',
                    webhookUrl: 'https://api.bohai.chat/web/telegram_webhook.php',
                    webhookStatus: false,
                    notificationStats: [],
                    configStatus: {},
                    savingTelegram: false,
                    testingConnection: false,
                    sendingTest: false,
                    settingWebhook: false,
                    gettingWebhook: false,
                    deletingWebhook: false
                }
            },
            mounted() {
                this.loadData();
            },
            methods: {
                async loadData() {
                    await Promise.all([
                        this.loadProducts(),
                        this.loadCategories(),
                        this.loadOrders(),
                        this.loadPaymentConfig(),
                        this.loadSystemSettings(),
                        this.loadTelegramConfig()
                    ]);
                },
                
                async loadProducts() {
                    // 模拟数据
                    this.products = [
                        {
                            id: 1,
                            name: 'iPhone 15 Pro',
                            description: '最新款iPhone',
                            category_id: 1,
                            category_name: '手机电脑',
                            price: 7999.00,
                            stock: 10,
                            image: '../images/products/iphone15.jpg',
                            status: 'active'
                        },
                        {
                            id: 2,
                            name: 'MacBook Pro 14"',
                            description: 'M3 Pro芯片',
                            category_id: 1,
                            category_name: '手机电脑',
                            price: 15999.00,
                            stock: 5,
                            image: '../images/products/macbook.jpg',
                            status: 'active'
                        }
                    ];
                },
                
                async loadCategories() {
                    this.categories = [
                        { id: 1, name: '手机电脑', description: '手机和电脑产品', product_count: 2 },
                        { id: 2, name: '配件周边', description: '各种配件', product_count: 0 },
                        { id: 3, name: '数码产品', description: '数码设备', product_count: 0 }
                    ];
                },
                
                async loadOrders() {
                    this.orders = [
                        {
                            order_no: 'NP20250914001',
                            total_amount: 7999.00,
                            payment_type: '微信支付',
                            status: 'success',
                            create_time: '2025-09-14 10:30:00'
                        }
                    ];
                },
                
                async loadPaymentConfig() {
                    // 从API加载支付配置
                },
                
                async loadSystemSettings() {
                    // 从API加载系统设置
                },
                
                editProduct(product) {
                    this.editingProduct = true;
                    this.productForm = { ...product };
                    this.showProductDialog = true;
                },
                
                async deleteProduct(product) {
                    try {
                        await this.$confirm('确定要删除这个商品吗？', '提示', {
                            confirmButtonText: '确定',
                            cancelButtonText: '取消',
                            type: 'warning'
                        });
                        
                        // 删除商品逻辑
                        this.$message.success('删除成功');
                        this.loadProducts();
                    } catch (error) {
                        // 用户取消删除
                    }
                },
                
                async saveProduct() {
                    try {
                        // 保存商品逻辑
                        this.$message.success('保存成功');
                        this.showProductDialog = false;
                        this.loadProducts();
                    } catch (error) {
                        this.$message.error('保存失败');
                    }
                },
                
                editCategory(category) {
                    this.editingCategory = true;
                    this.categoryForm = { ...category };
                    this.showCategoryDialog = true;
                },
                
                async deleteCategory(category) {
                    try {
                        await this.$confirm('确定要删除这个分类吗？', '提示', {
                            confirmButtonText: '确定',
                            cancelButtonText: '取消',
                            type: 'warning'
                        });
                        
                        this.$message.success('删除成功');
                        this.loadCategories();
                    } catch (error) {
                        // 用户取消删除
                    }
                },
                
                async saveCategory() {
                    try {
                        this.$message.success('保存成功');
                        this.showCategoryDialog = false;
                        this.loadCategories();
                    } catch (error) {
                        this.$message.error('保存失败');
                    }
                },
                
                viewOrder(order) {
                    this.$alert(`订单详情：${order.order_no}`, '订单信息', {
                        confirmButtonText: '确定'
                    });
                },
                
                getOrderStatusType(status) {
                    const types = {
                        'pending': 'warning',
                        'success': 'success',
                        'failed': 'danger',
                        'expired': 'info'
                    };
                    return types[status] || 'info';
                },
                
                getOrderStatusText(status) {
                    const texts = {
                        'pending': '待支付',
                        'success': '支付成功',
                        'failed': '支付失败',
                        'expired': '已过期'
                    };
                    return texts[status] || status;
                },
                
                async savePaymentConfig() {
                    this.savingConfig = true;
                    try {
                        // 保存支付配置逻辑
                        this.$message.success('配置保存成功');
                    } catch (error) {
                        this.$message.error('保存失败');
                    } finally {
                        this.savingConfig = false;
                    }
                },
                
                async saveSystemSettings() {
                    this.savingSettings = true;
                    try {
                        // 保存系统设置逻辑
                        this.$message.success('设置保存成功');
                    } catch (error) {
                        this.$message.error('保存失败');
                    } finally {
                        this.savingSettings = false;
                    }
                },
                
                // Telegram相关方法
                async loadTelegramConfig() {
                    try {
                        const response = await fetch('https://api.bohai.chat/web/Telegram.php?action=config');
                        const result = await response.json();
                        if (result.code === 200) {
                            this.telegramConfig = {
                                enabled: result.result.enabled === 'true',
                                bot_token: result.result.bot_token || '',
                                chat_id: result.result.chat_id || ''
                            };
                            this.webhookStatus = result.result.status === 'connected';
                        }
                    } catch (error) {
                        console.error('加载Telegram配置失败:', error);
                    }
                },
                
                async saveTelegramConfig() {
                    this.savingTelegram = true;
                    try {
                        const response = await fetch('https://api.bohai.chat/web/Telegram.php?action=config', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify(this.telegramConfig)
                        });
                        const result = await response.json();
                        if (result.code === 200) {
                            this.$message.success('Telegram配置保存成功');
                        } else {
                            this.$message.error(result.msg);
                        }
                    } catch (error) {
                        this.$message.error('保存失败');
                    } finally {
                        this.savingTelegram = false;
                    }
                },
                
                async testTelegramConnection() {
                    this.testingConnection = true;
                    try {
                        const response = await fetch('https://api.bohai.chat/web/Telegram.php?action=test_connection');
                        const result = await response.json();
                        if (result.code === 200) {
                            this.$message.success('Telegram连接测试成功');
                        } else {
                            this.$message.error(result.msg);
                        }
                    } catch (error) {
                        this.$message.error('连接测试失败');
                    } finally {
                        this.testingConnection = false;
                    }
                },
                
                async sendTestMessage() {
                    this.sendingTest = true;
                    try {
                        const response = await fetch('https://api.bohai.chat/web/Telegram.php?action=send_test');
                        const result = await response.json();
                        if (result.code === 200) {
                            this.$message.success('测试消息发送成功');
                        } else {
                            this.$message.error(result.msg);
                        }
                    } catch (error) {
                        this.$message.error('发送测试消息失败');
                    } finally {
                        this.sendingTest = false;
                    }
                },
                
                async setWebhook() {
                    this.settingWebhook = true;
                    try {
                        const response = await fetch('https://api.bohai.chat/web/Telegram.php?action=set_webhook', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/x-www-form-urlencoded',
                            },
                            body: `webhook_url=${encodeURIComponent(this.webhookUrl)}`
                        });
                        const result = await response.json();
                        if (result.code === 200) {
                            this.$message.success('Webhook设置成功');
                            this.webhookStatus = true;
                        } else {
                            this.$message.error(result.msg);
                        }
                    } catch (error) {
                        this.$message.error('设置Webhook失败');
                    } finally {
                        this.settingWebhook = false;
                    }
                },
                
                async getWebhookInfo() {
                    this.gettingWebhook = true;
                    try {
                        const response = await fetch('https://api.bohai.chat/web/Telegram.php?action=get_webhook');
                        const result = await response.json();
                        if (result.code === 200) {
                            this.$alert(JSON.stringify(result.result, null, 2), 'Webhook信息', {
                                confirmButtonText: '确定'
                            });
                        } else {
                            this.$message.error(result.msg);
                        }
                    } catch (error) {
                        this.$message.error('获取Webhook信息失败');
                    } finally {
                        this.gettingWebhook = false;
                    }
                },
                
                async deleteWebhook() {
                    this.deletingWebhook = true;
                    try {
                        const response = await fetch('https://api.bohai.chat/web/Telegram.php?action=delete_webhook');
                        const result = await response.json();
                        if (result.code === 200) {
                            this.$message.success('Webhook删除成功');
                            this.webhookStatus = false;
                        } else {
                            this.$message.error(result.msg);
                        }
                    } catch (error) {
                        this.$message.error('删除Webhook失败');
                    } finally {
                        this.deletingWebhook = false;
                    }
                },
                
                async refreshStats() {
                    try {
                        const response = await fetch('https://api.bohai.chat/web/Telegram.php?action=notification_stats');
                        const result = await response.json();
                        if (result.code === 200) {
                            this.notificationStats = result.result;
                        }
                        
                        const configResponse = await fetch('https://api.bohai.chat/web/Telegram.php?action=check_config');
                        const configResult = await configResponse.json();
                        if (configResult.code === 200) {
                            this.configStatus = configResult.result.telegram || {};
                        }
                    } catch (error) {
                        console.error('刷新统计失败:', error);
                    }
                },
                
                async testNotification() {
                    try {
                        const response = await fetch('https://api.bohai.chat/web/Telegram.php?action=test_notification');
                        const result = await response.json();
                        if (result.code === 200) {
                            this.$message.success('通知测试完成');
                        } else {
                            this.$message.error(result.msg);
                        }
                    } catch (error) {
                        this.$message.error('通知测试失败');
                    }
                },
                
                async sendSystemStatus() {
                    try {
                        const response = await fetch('https://api.bohai.chat/web/Telegram.php?action=system_status');
                        const result = await response.json();
                        if (result.code === 200) {
                            this.$message.success('系统状态报告发送成功');
                        } else {
                            this.$message.error(result.msg);
                        }
                    } catch (error) {
                        this.$message.error('发送系统状态报告失败');
                    }
                },
                
                getNotificationTypeName(type) {
                    const names = {
                        'new_order': '新订单',
                        'payment_success': '支付成功',
                        'payment_failed': '支付失败',
                        'order_cancelled': '订单取消',
                        'low_stock': '库存不足',
                        'system_alert': '系统警告'
                    };
                    return names[type] || type;
                },
                
                getConfigKeyName(key) {
                    const names = {
                        'enabled': '启用状态',
                        'bot_token': 'Bot Token',
                        'chat_id': 'Chat ID'
                    };
                    return names[key] || key;
                },
                
                handleImageChange(file) {
                    // 处理图片上传
                    this.productForm.image = URL.createObjectURL(file.raw);
                }
            }
        });
    </script>
</body>
</html>
